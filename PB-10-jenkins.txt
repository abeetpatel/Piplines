pipeline {
    agent any
 
    environment {
        JAVA_HOME = "C:\\Program Files\\Java\\jdk-11.0.15.1"
        MAVEN_HOME = "C:\\ProgramData\\Jenkins\\.jenkins\\tools\\hudson.tasks.Maven_MavenInstallation\\Maven"
        BACKEND_DIR = "${WORKSPACE}\\Project-10"
        BACKEND_PORT = "8084"
        JAR_NAME = "springboottest-0.0.1-SNAPSHOT.jar"
        PATH = "${JAVA_HOME}\\bin;${MAVEN_HOME}\\bin;${env.PATH}"
    }
 
    stages {
        stage('Cleanup') {
            steps {
                echo "Cleaning workspace..."
                deleteDir()
            }
        }
 
        stage('Clone Repo') {
            steps {
                echo "Cloning repo using provided credentials..."
                git credentialsId: 'github-credentials', url: 'https://github.com/abeetpatel/Project-10-Backend.git', branch: 'main'
            }
        }
 
        stage('Build Backend') {
            steps {
                echo "Building backend with Maven..."
                dir("${BACKEND_DIR}") {
                    bat "mvn clean package -DskipTests"
                }
            }
        }
 
        stage('Run Backend') {
            steps {
                echo "Starting backend in background..."
                dir("${BACKEND_DIR}/target") {
                   bat "dir"
                    bat "java -jar ${JAR_NAME}"
                }
            }
        }
    }
 
    post {
        always {
            echo "âœ… Pipeline finished. If the backend was started, logs are available in the console."
        }
    }
}